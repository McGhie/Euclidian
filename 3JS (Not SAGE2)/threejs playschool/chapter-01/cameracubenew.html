<!DOCTYPE html>

<html>

<head>
    <title>Example 01.03 - Materials and light</title>
    <script type="text/javascript" src="../libs/three.js"></script>
    <script type="text/javascript" src="../libs/stats.js"></script>
    <script type="text/javascript" src="../libs/dat.gui.js"></script>
		<script type="text/javascript" src="../datafiles/3xyz.30.json"></script>
		<script type="text/javascript" src="../datafiles/color.json"></script>
		
		<script type="text/javascript" src="../libs/OBJLoader.js"></script>
    <script type="text/javascript" src="../libs/MTLLoader.js"></script>
    <script type="text/javascript" src="../libs/OBJMTLLoader.js"></script>
	<script type="text/javascript" src="../libs/OrbitControls.js"></script>
	  <script type="text/javascript" src="../libs/stats.js"></script>
    <script type="text/javascript" src="../libs/dat.gui.js"></script>
    <script type="text/javascript" src="../libs/chroma.js"></script>
    <script type="text/javascript" src="../libs/FlyControls.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	
	
	
    <style>
        body {
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
			}
			.webgl {
    height:100vh;
    width:100vw;
}
.click {
    position:absolute;
    top:1%;
    width:auto;
    height:20px;
    border:1px solid red;
    cursor:pointer;
    color:black;
    background-color:white;
}
			
			
			
			
			
        
    </style>
</head>
<body>







<!-- Div which will hold the Output -->


<div class="click">Move Camera</div>
<div class="webgl"></div>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">
var camera;
var controls;
var scene;
var torus;
var light;
var renderer;
var w = window.innerWidth;
var h = window.innerHeight;
var tween;

var X1,Y1,Z1;

init();
animate();

function init() {
    //camera
	
	X1 =0;
	Y1 =0;
	Z1 =0;
	
	
    camera = new THREE.PerspectiveCamera(45, w / h, 1, 5000);
    camera.position.set(0, 200, -500);

    //controls
    controls = new THREE.OrbitControls(camera);
    controls.rotateSpeed = 1.0;
    controls.zoomSpeed = 1.2;
    controls.panSpeed = 0.8;

    //Scene
    scene = new THREE.Scene();

    // Helpers
    axes = new THREE.AxisHelper(500);
    helper = new THREE.GridHelper(1000, 10);
    helper.setColors(0x0000ff, 0x808080);
    scene.add(axes);
    //scene.add(helper);
  
  //TEXT FOR COORDS
  
	var groupCubes = new THREE.Object3D();
	var group = new THREE.Group();
	
	  var mydata=JSON.parse(xyz);
		var myrgb=JSON.parse(rgb);
		particleCount=Object.keys(mydata).length;
		
		particleCount=150000;
	
	    var cubeGeometry = new THREE.BoxGeometry(.6, .01, .6);
		 var cubeGeometryY = new THREE.BoxGeometry(.6, 1.2, .6);
		  var cubeGeometryNothing = new THREE.BoxGeometry(.0, .0, .0);
		  
		  //adding floor
		  var floorspace = new THREE.BoxGeometry(250, 0, 250);
		  var floorcolor = new THREE.Color("#E7FEFF");
	      var floorMaterial = new THREE.MeshLambertMaterial({color: floorcolor});
		  var floor = new THREE.Mesh(floorspace, floorMaterial);
		floor.castShadow = false;
	        floor.position.x = 0; 
			 floor.position.y = 0;
			floor.position.z = 0;
		   scene.add(floor);
		  
       var Coef = 100;
	   var cube = []; 
	   var p = 0;
	   var colorsmall=0;
	   var colorspace=0;
       for (i = 0; i < particleCount; i++) {
	 //  console.log(i);
		var X=mydata[i][0]*Coef;
	    var Y=(mydata[i][2]*Coef-(Coef*2.5))*-1;
	    var Z=(mydata[i][1]*Coef);
		
		if (i>2){
		var OLDY= (mydata[i-1][2]*Coef-(Coef*2.5))*-1;
		}
		if (i<particleCount-1){
		var NEWY= (mydata[i+1][2]*Coef-(Coef*2.5))*-1;
		}
		
		var hexString=myrgb[5];
		
		colorsmall++;
		if (Y<37){
		hexString="00308F";
	    }
		else if (Y<50){
		hexString="008000";
		}
		else if (Y<160){
		hexString="FDEE00";
		}
		else if (Y<500){
		hexString="BFFF00";
		}
		
		if (Y+1<OLDY||Y-1>NEWY){
			hexString="FF007F";
		}
		
		
		
		var color1 = new THREE.Color("#"+hexString);
	    var cubeMaterial = new THREE.MeshBasicMaterial({
		color: color1,
		wireframe:true
		});
		//  var cubeMaterial = new THREE.MeshLambertMaterial({color: 0xff0500});
        
		if (Y+1<OLDY||Y-1>NEWY){
			cube[i] = new THREE.Mesh(cubeGeometryY, cubeMaterial);
		}
		
		else if(Y+1.2<OLDY||Y-1.2>OLDY){
		cube[i] = new THREE.Mesh(cubeGeometryNothing, cubeMaterial);
		
			console.log("dont display");
		}
		else{
		cube[i] = new THREE.Mesh(cubeGeometry, cubeMaterial);
		}
		
		
        cube[i].castShadow = false;
	        cube[i].position.x = X; 
			 cube[i].position.y = Y;
			cube[i].position.z = Z;
	 
	 
	 
	      // add the cube to the scene
		var ify=50005500;
		
		
		if (X>X1){X1=X;}
		if (Y>Y1){Y1=Y;}
		if (Z>Z1){Z1=Z;}
	console.log(X1+" "+Y1+" "+Z1);
	
	
	
		if (Y<5||Y>90||X>120||Z>120){
		console.log(p++);
		//scene.add(cube[i]);
		}
		else{
		
        group.add(cube[i]);
		
		}
		
		}
		scene.add(group);

    //Hemisphere Light
    light = new THREE.HemisphereLight(0xffbf67, 0x15c6ff);
    scene.add(light);

    //WebGL Renderer
    renderer = new THREE.WebGLRenderer({
        antialias: true
    });
    //renderer.setClearColor(0xffffff, 1)
    renderer.setSize(w, h);
    $('.webgl').append(renderer.domElement);

    var posX = camera.position.x - 100;
    var posY = camera.position.y - 100;
    var posZ = camera.position.z - 100;


    $('.click').click(function () {
        var from = {
            x: camera.position.x,
            y: camera.position.y,
            z: camera.position.z
        };

        var to = {
            x: posX,
            y: posY,
            z: posZ
        };
        tween = new TWEEN.Tween(from)
            .to(to, 600)
            .easing(TWEEN.Easing.Linear.None)
            .onUpdate(function () {
            camera.position.set(this.x, this.y, this.z);
            camera.lookAt(new THREE.Vector3(0, 0, 0));
        })
            .onComplete(function () {
            camera.lookAt(new THREE.Vector3(0, 0, 0));
        })
            .start();
    });
}


function animate() {
   // TWEEN.update();
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
    controls.update();
}



</script>
</body>
</html>